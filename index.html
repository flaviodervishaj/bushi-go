<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUSHI-GO: WAR ROOM</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --wood: #1a1410;
            --parchment: #e8d5b5;
            --crimson: #800000;
            --ink: #1a1a1a;
            --gold: #b8860b;
        }

        body { 
            font-family: 'Press Start 2P', cursive; 
            background-color: var(--wood);
            background-image: url("https://www.transparenttextures.com/patterns/dark-wood.png");
            color: var(--ink);
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden; 
        }

        .map-panel {
            background-color: var(--parchment);
            background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
            border: 6px solid #000;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.5);
            position: relative;
        }

        .stance-container { display: flex; flex-direction: column; gap: 12px; height: 100%; }
        
        .hanko-stance {
            background: #fffdf9;
            border: 4px solid var(--ink);
            padding: 18px 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 5px 5px 0px var(--crimson);
        }

        /* Standard Hover */
        .hanko-stance:hover { 
            background: var(--crimson); 
            transform: translateX(10px);
            box-shadow: 5px 5px 0px var(--gold);
        }
        .hanko-stance:hover span { color: white !important; }

        /* NINJA STEALTH HOVER */
        .hanko-stance:nth-child(2):hover {
            background: #1a1a1a !important;
            box-shadow: 0 0 15px #00ffcc !important;
            border-color: #00ffcc !important;
        }
        .hanko-stance:nth-child(2):hover span { color: #00ffcc !important; }

        /* AGGRESSIVE KATANA HOVER */
        .katana-btn:hover {
            background: #000 !important;
            box-shadow: 0 0 20px #ff0000 !important;
            border-color: #ff0000 !important;
        }
        .katana-btn:hover .stance-title, .katana-btn:hover .stance-desc { color: #ff0000 !important; }

        .stance-title { font-size: 10px; display: block; margin-bottom: 5px; font-weight: bold; pointer-events: none; }
        .stance-desc { font-size: 6px; color: #666; pointer-events: none; text-transform: uppercase; }

        .crest-image {
            width: 130px; height: 130px;
            border: 4px solid var(--ink);
            image-rendering: pixelated;
            margin: 0 auto 15px;
            background: #fff;
            box-shadow: 6px 6px 0px var(--crimson);
        }

        .stat-bar-frame { height: 18px; background: rgba(0,0,0,0.1); border: 2px solid #000; margin: 6px 0; overflow: hidden; }
        .stat-fill { height: 100%; width: 0%; background: var(--crimson); transition: width 1s ease-out; }

        textarea { 
            background: transparent; border: none; width: 100%; height: 100%; 
            outline: none; font-family: 'Press Start 2P', cursive; 
            font-size: 10px; line-height: 1.8; resize: none; color: var(--ink);
        }

        .guide-box {
            background: #f4e8d1;
            border: 3px solid var(--gold);
            padding: 30px 20px;
            margin-top: 20px;
            flex-grow: 1; 
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .guide-box h3 { font-size: 9px; color: var(--crimson); margin-bottom: 25px; text-decoration: underline; text-align: center; }
        .tactic-entry { margin-bottom: 20px; }
        .tactic-label { font-size: 7px; color: var(--gold); display: block; margin-bottom: 8px; font-weight: bold; }
        .tactic-text { font-size: 6px; line-height: 2.4; color: #333; display: block; text-align: justify; }

        .dojo-footer { margin-top: auto; padding: 10px 0; text-align: center; color: var(--parchment); font-size: 8px; letter-spacing: 2px; }
    </style>
</head>
<body>

    <header class="text-center mb-6">
        <h1 class="text-white text-3xl" style="text-shadow: 5px 5px 0px var(--crimson);">武士道 BUSHI-GO</h1>
        <div class="text-[8px] text-[#b8860b] mt-2 tracking-widest">[ FORGING DISCIPLINED SCRIPT ]</div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 flex-grow overflow-hidden px-4">
        <div class="lg:col-span-3 flex flex-col h-full overflow-hidden">
            <div class="stance-container">
                <div onclick="strike('professional')" class="hanko-stance">
                    <span class="stance-title">SHOGUN</span>
                    <span class="stance-desc">Formal Diplomacy</span>
                </div>
                <div onclick="strike('short')" class="hanko-stance">
                    <span class="stance-title">NINJA</span>
                    <span class="stance-desc">Double-Strike Brevity</span>
                </div>
                <div onclick="strike('vibe')" class="hanko-stance katana-btn">
                    <span class="stance-title" style="color:var(--crimson)">KATANA</span>
                    <span class="stance-desc">Lethal Clarity</span>
                </div>

                <div class="guide-box">
                    <h3>TACTICAL PROTOCOLS</h3>
                    <div class="tactic-entry">
                        <span class="tactic-label">● SHOGUN PROTOCOL</span>
                        <span class="tactic-text">Transform raw frustration into polite, unshakeable authority. Honor is maximum.</span>
                    </div>
                    <div class="tactic-entry">
                        <span class="tactic-label">● NINJA PROTOCOL</span>
                        <span class="tactic-text">The "Double-Strike." Exactly two sentences: One to identify the problem, one to give the command.</span>
                    </div>
                    <div class="tactic-entry">
                        <span class="tactic-label">● KATANA PROTOCOL</span>
                        <span class="tactic-text">Sharp professional truth. Use when respect has failed. High impact, low honor.</span>
                    </div>
                    <div class="tactic-entry" style="border:none; margin-top: auto; padding-top: 20px; border-top: 2px dashed rgba(0,0,0,0.1);">
                        <span class="tactic-label" style="color:var(--crimson)">STRATEGIC INSIGHT:</span>
                        <span class="tactic-text" style="font-style: italic; opacity: 0.8;">"An undisciplined tongue is a broken blade. Forge before you strike."</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-5 map-panel p-8">
            <p class="text-[7px] mb-4 opacity-50 font-bold border-b border-black/10 pb-2">RAW MANUSCRIPT</p>
            <textarea id="emailInput" placeholder="Input your draft thoughts..."></textarea>
        </div>

        <div class="lg:col-span-4 flex flex-col gap-6">
            <div class="map-panel p-6 h-[45%] flex flex-col items-center justify-center">
                <img src="crest.png" class="crest-image" alt="Bushi Crest" onerror="this.src='https://via.placeholder.com/130/800000/FFFFFF?text=CREST'">
                <div class="w-full px-4">
                    <p class="text-[6px] mb-1">HONOR</p>
                    <div class="stat-bar-frame"><div id="honorFill" class="stat-fill"></div></div>
                    <p class="text-[6px] mt-2 mb-1">STEALTH</p>
                    <div class="stat-bar-frame"><div id="stealthFill" class="stat-fill" style="background:var(--gold)"></div></div>
                </div>
            </div>

            <div class="map-panel p-8 h-[55%] flex flex-col">
                <p class="text-[7px] mb-4 opacity-50 font-bold border-b border-black/10 pb-2">FORGED STEEL</p>
                <div id="output" class="text-[10px] leading-loose flex-grow italic overflow-y-auto">The anvil is silent...</div>
                <button onclick="copyText()" class="mt-4 bg-black text-white p-4 text-[8px] hover:invert transition-all border-2 border-transparent hover:border-white">
                    COLLECT SCROLL
                </button>
            </div>
        </div>
    </div>
    <footer class="dojo-footer">PROJECT BY FLAVIO DERVISHAJ</footer>

    <script>
        async function strike(mode) {
            const textInput = document.getElementById('emailInput');
            const text = textInput.value.trim();
            if(!text) return alert("Stone is cold.");
            
            document.getElementById('output').innerText = "FORGING...";
            
            try {
                const response = await fetch('http://127.0.0.1:8000/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ text, mode })
                });
                const data = await response.json();
                document.getElementById('output').innerText = data.refined_text;
                document.getElementById('honorFill').style.width = data.honor + '%';
                document.getElementById('stealthFill').style.width = data.stealth + '%';
            } catch (err) {
                document.getElementById('output').innerText = "OFFLINE.";
            }
        }

        function copyText() {
            const t = document.getElementById('output').innerText;
            navigator.clipboard.writeText(t);
            alert("COPIED.");
        }
    </script>
</body>
</html>