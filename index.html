<!doctype html>
<html lang="en">
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta charset="UTF-8" />
    <title>BUSHI-GO: WAR ROOM</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        --wood: #1a1410;
        --parchment: #e8d5b5;
        --crimson: #800000;
        --ink: #1a1a1a;
        --gold: #b8860b;
      }

      body {
        font-family: "Press Start 2P", cursive;
        background-color: var(--wood);
        background-image: url("https://www.transparenttextures.com/patterns/dark-wood.png");
        color: var(--ink);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        padding: 20px;
        margin: 0;
      }

      .map-panel {
        background-color: var(--parchment);
        background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
        border: 6px solid #000;
        box-shadow: 10px 10px 0px rgba(0, 0, 0, 0.5);
        position: relative;
      }

      /* STANCE BUTTONS */
      .hanko-stance {
        background: #fffdf9;
        border: 4px solid var(--ink);
        padding: 18px 10px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
        box-shadow: 5px 5px 0px var(--crimson);
      }

      .hanko-stance:hover {
        background: var(--crimson);
        transform: translateX(10px);
        box-shadow: 5px 5px 0px var(--gold);
      }
      .hanko-stance:hover span { color: white !important; }

      /* Special Hovers */
      .hanko-stance:nth-child(2):hover {
        background: #1a1a1a !important;
        box-shadow: 0 0 15px #00ffcc !important;
        border-color: #00ffcc !important;
      }
      .hanko-stance:nth-child(2):hover span { color: #00ffcc !important; }

      .katana-btn:hover {
        background: #000 !important;
        box-shadow: 0 0 20px #ff0000 !important;
        border-color: #ff0000 !important;
      }
      .katana-btn:hover .stance-title, .katana-btn:hover .stance-desc { color: #ff0000 !important; }

      .stance-title { font-size: 10px; display: block; margin-bottom: 5px; font-weight: bold; }
      .stance-desc { font-size: 6px; color: #666; text-transform: uppercase; }

      /* UI Elements */
      textarea {
        background: transparent;
        border: none;
        width: 100%;
        height: 100%;
        min-height: 250px; /* Reduced to leave room for output */
        outline: none;
        font-family: "Press Start 2P", cursive;
        font-size: 10px;
        line-height: 1.8;
        resize: none;
        color: var(--ink);
      }

      .guide-box {
        background: #f4e8d1;
        border: 3px solid var(--gold);
        padding: 30px 20px;
        margin-top: 20px;
        flex-grow: 1;
        box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .stat-fill { height: 100%; width: 0%; background: var(--crimson); transition: width 1s ease-out; }

      /* THE FIX: Flexible Heights */
      .war-room-grid {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      @media (min-width: 1024px) {
        body { height: 100vh; overflow: hidden; }
        .war-room-grid { 
          display: grid; 
          grid-template-columns: repeat(12, minmax(0, 1fr)); 
          height: 100%; 
        }
      }
    </style>
  </head>
  <body>
    <header class="text-center mb-6">
      <h1 class="text-white text-3xl" style="text-shadow: 5px 5px 0px var(--crimson)">武士道 BUSHI-GO</h1>
      <div class="text-[8px] text-[#b8860b] mt-2 tracking-widest">[ FORGING DISCIPLINED SCRIPT ]</div>
    </header>

    <div class="war-room-grid flex-grow px-4 lg:overflow-hidden">
      
      <div class="lg:col-span-5 map-panel p-8 order-1 lg:order-2">
        <p class="text-[7px] mb-4 opacity-50 font-bold border-b border-black/10 pb-2">RAW MANUSCRIPT</p>
        <textarea id="emailInput" placeholder="Input your draft thoughts..."></textarea>
      </div>

      <div class="lg:col-span-3 flex flex-col h-full order-2 lg:order-1">
        <div class="flex flex-col gap-3">
          <div onclick="strike('professional')" class="hanko-stance">
            <span class="stance-title">SHOGUN</span>
            <span class="stance-desc">Formal Diplomacy</span>
          </div>
          <div onclick="strike('short')" class="hanko-stance">
            <span class="stance-title">NINJA</span>
            <span class="stance-desc">Double-Strike Brevity</span>
          </div>
          <div onclick="strike('vibe')" class="hanko-stance katana-btn">
            <span class="stance-title" style="color: var(--crimson)">KATANA</span>
            <span class="stance-desc">Lethal Clarity</span>
          </div>
        </div>

        <div class="guide-box">
          <div>
            <h3 class="text-[9px] text-red-800 underline mb-6 text-center">TACTICAL PROTOCOLS</h3>
            <div class="mb-6">
              <span class="text-[7px] text-[#b8860b] block font-bold mb-2">● SHOGUN PROTOCOL</span>
              <span class="text-[6px] leading-loose block text-justify">Transform raw frustration into polite, unshakeable authority. Honor is paramount.</span>
            </div>
            <div class="mb-6">
              <span class="text-[7px] text-[#b8860b] block font-bold mb-2">● NINJA PROTOCOL</span>
              <span class="text-[6px] leading-loose block text-justify">Exactly two sentences: One to identify the problem, one to give the command.</span>
            </div>
            <div>
              <span class="text-[7px] text-[#b8860b] block font-bold mb-2">● KATANA PROTOCOL</span>
              <span class="text-[6px] leading-loose block text-justify">Sharp professional truth. Use when respect has failed. High impact, low honor.</span>
            </div>
          </div>
          <div class="pt-6 border-t-2 border-dashed border-black/10 mt-6">
            <span class="text-[7px] text-red-800 block font-bold mb-2">STRATEGIC INSIGHT:</span>
            <p class="text-[6px] italic opacity-0.8 leading-relaxed">"An undisciplined tongue is a broken blade. Forge before you strike."</p>
          </div>
        </div>
      </div>

      <div class="lg:col-span-4 flex flex-col gap-6 order-3">
        <div class="map-panel p-6 flex flex-col items-center justify-center">
          <img src="crest.PNG" class="w-[110px] h-[110px] border-4 border-black shadow-[6px_6px_0px_#800000] mb-4" onerror="this.src='https://via.placeholder.com/130/800000/FFFFFF?text=CREST'"/>
          <div class="w-full px-2">
            <p class="text-[6px] mb-1">HONOR</p>
            <div class="h-4 bg-black/10 border-2 border-black overflow-hidden"><div id="honorFill" class="stat-fill"></div></div>
            <p class="text-[6px] mt-2 mb-1">STEALTH</p>
            <div class="h-4 bg-black/10 border-2 border-black overflow-hidden"><div id="stealthFill" class="stat-fill" style="background: var(--gold)"></div></div>
          </div>
        </div>

        <div class="map-panel p-8 flex flex-col min-h-[300px] flex-grow">
          <p class="text-[7px] mb-4 opacity-50 font-bold border-b border-black/10 pb-2">FORGED STEEL</p>
          <div id="output" class="text-[10px] leading-loose flex-grow italic overflow-y-auto mb-4">The anvil is silent...</div>
          <button onclick="copyText()" class="w-full bg-black text-white p-4 text-[8px] hover:invert transition-all border-2 border-transparent hover:border-white">
            COLLECT SCROLL
          </button>
        </div>
      </div>
    </div>
    
    <footer class="text-center p-4 text-white text-[8px] opacity-50">PROJECT BY FLAVIO DERVISHAJ</footer>

    <script>
      async function strike(mode) {
        const text = document.getElementById("emailInput").value.trim();
        if (!text) return alert("Stone is cold. Input thoughts first.");
        document.getElementById("output").innerText = "FORGING...";
        try {
          const response = await fetch("https://bushi-go.onrender.com/analyze", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text, mode }),
          });
          const data = await response.json();
          document.getElementById("output").innerText = data.refined_text;
          document.getElementById("honorFill").style.width = data.honor + "%";
          document.getElementById("stealthFill").style.width = data.stealth + "%";
        } catch (err) {
          document.getElementById("output").innerText = "OFFLINE.";
        }
      }
      function copyText() {
        const t = document.getElementById("output").innerText;
        navigator.clipboard.writeText(t);
        alert("COPIED.");
      }
    </script>
  </body>
</html>